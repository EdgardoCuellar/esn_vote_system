{% extends 'base.html' %}

{% block content %}
{% load custom_filter %}

<div class="flex flex-col min-h-full justify-center items-center px-6 lg:px-8 pb-8">
  <div class="max-w-md w-full glass-card p-6 md:p-8">
    <h1 class="text-2xl font-title font-bold mb-4 text-slate-800">ESN ULB Brussels - Results</h1>
    <h2 class="text-lg font-semibold mb-4 text-slate-700">{{ vote.title }}</h2>
    <h2 class="text-sm font-medium mb-4 text-slate-600">Date: {{ vote.session.date }}</h2>
    <p class="text-sm text-slate-600 mb-4">{{ vote.description }}</p>
    <p class="text-sm text-slate-600">Number of votes: {{ vote.id|get_number_of_votes }}</p>
  </div>

  {% if vote.max_num_choices == 1 %}
  <div class="max-w-md w-full glass-card p-6 md:p-8 mt-4">
    <canvas id="myChart"></canvas>
  </div>
  {% else %}
  <div class="max-w-md w-full glass-card p-6 md:p-8 mt-4">
    <canvas id="myChart"></canvas>
  </div>
  {% endif %}

  <div class="max-w-md w-full glass-card p-6 md:p-8 mt-4">
    <h2 class="text-lg font-semibold mb-4 text-slate-700">Votes</h2>
    <div class="flex flex-col space-y-2">
      {% for option in options %}
      <div class="flex flex-row justify-between items-center py-2 px-4 border-b border-slate-200">
        <span class="text-slate-700">{{ option.option_text }}</span>
        <span class="text-slate-700">{{ option.number_votes }}</span>
      </div>
      {% endfor %}
    </div>
  </div>

  <a href="{% url 'admin_view' %}" class="mt-8 glass-btn px-8 py-3 rounded-2xl text-base mx-auto"
     style="background-image: linear-gradient(90deg, rgba(244,123,32,0.95), rgba(244,150,50,0.92));">
    Back
  </a>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{% if vote.max_num_choices == 1 %}
<script>
  const ctx = document.getElementById('myChart');

  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: [
        {% for option in options %}
          '{{ option.option_text }}',
        {% endfor %}
      ],
      datasets: [{
        label: '# of Votes',
        data: [
          {% for option in options %}
            {{ option.number_votes }},
          {% endfor %}
        ],
        backgroundColor: [
          'rgba(75, 192, 192, 0.5)',
          'rgba(255, 99, 132, 0.5)',
          'rgba(255, 206, 86, 0.5)',
          'rgba(54, 162, 235, 0.5)',
          'rgba(153, 102, 255, 0.5)'
        ],
        borderColor: [
          'rgba(75, 192, 192, 1)',
          'rgba(255, 99, 132, 1)',
          'rgba(255, 206, 86, 1)',
          'rgba(54, 162, 235, 1)',
          'rgba(153, 102, 255, 1)'
        ],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'top',
        }
      }
    }
  });
</script>
{% else %}
<script>
  const ctx = document.getElementById('myChart');

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [
        {% for option in options %}
          '{{ option.option_text }}',
        {% endfor %}
      ],
      datasets: [{
        label: '# of Votes',
        data: [
          {% for option in options %}
            {{ option.number_votes }},
          {% endfor %}
        ],
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        borderColor: 'rgba(75, 192, 192, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>
{% endif %}
{% endblock %}
