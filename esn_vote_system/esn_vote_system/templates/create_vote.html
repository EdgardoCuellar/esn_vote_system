{% extends 'base.html' %}

{% block title %}ESN ULB Brussels - Create Vote{% endblock %}

{% block content %}
<div class="flex justify-center px-6 lg:px-8">
  <div class="max-w-md w-full glass-card p-6 md:p-8">
    <h1 class="text-2xl font-title font-bold mb-6 text-slate-800">Create a New Vote</h1>

    <form action="{% url 'create_vote' %}" method="post" class="flex flex-col gap-4">
      {% csrf_token %}
      <div class="flex flex-col">
        <label for="title" class="mb-2 text-sm font-medium text-slate-700">Title</label>
        <input id="title" name="title" type="text" placeholder="Enter title"
               class="glass-input focus-ring px-4 py-3 rounded-2xl text-slate-800 placeholder:text-slate-400 transition-shadow"
               required>
      </div>

      <div class="flex flex-col">
        <label for="description" class="mb-2 text-sm font-medium text-slate-700">Description</label>
        <textarea id="description" name="description" placeholder="Enter description"
                  class="glass-input focus-ring px-4 py-3 rounded-2xl text-slate-800 placeholder:text-slate-400 transition-shadow"
                  required></textarea>
      </div>

      <div class="flex flex-col">
        <label for="max_num_choices" class="mb-2 text-sm font-medium text-slate-700">Maximum Number of Choices</label>
        <input id="max_num_choices" name="max_num_choices" type="number" min="1" value="1"
               class="glass-input focus-ring px-4 py-3 rounded-2xl text-slate-800 placeholder:text-slate-400 transition-shadow">
      </div>

      <div class="flex flex-col">
        <label for="session_id" class="mb-2 text-sm font-medium text-slate-700">Session</label>
        <select id="session_id" name="session_id"
                class="glass-input focus-ring px-4 py-3 rounded-2xl text-slate-800 placeholder:text-slate-400 transition-shadow"
                required>
          {% for session in sessions %}
            <option value="{{ session.id }}">{{ session.title }}</option>
          {% endfor %}
        </select>
      </div>

      <div id="options-container" class="flex flex-col gap-4">
        <label class="text-sm font-medium text-slate-700">Options</label>
        <div class="flex items-center gap-4">
          <input name="option_text" type="text" placeholder="Enter option"
                 class="glass-input focus-ring px-4 py-3 rounded-2xl text-slate-800 placeholder:text-slate-400 transition-shadow flex-grow"
                 required>
        </div>
        <div class="flex items-center gap-4">
          <input name="option_text" type="text" placeholder="Enter option"
                 class="glass-input focus-ring px-4 py-3 rounded-2xl text-slate-800 placeholder:text-slate-400 transition-shadow flex-grow"
                 required>
        </div>
      </div>

      <button type="button" onclick="addOption()"
              class="glass-btn px-4 py-2 rounded-2xl text-sm mx-auto" style="background-image: linear-gradient(90deg, rgba(65, 154, 186, 0.95), rgba(0,200,255,0.92));">
        + Add Option
      </button>

      <button type="submit"
              class="glass-btn px-4 py-3 rounded-2xl text-base mx-auto" style="background-image: linear-gradient(90deg, rgba(105, 186, 43, 0.95), rgba(66, 115, 23, 0.92));">
        Create Vote
      </button>
    </form>

    <a href="{% url 'admin_view' %}" class="mt-8 w-full glass-btn px-4 py-3 rounded-2xl text-center"
       style="background-image: linear-gradient(90deg, rgba(244,123,32,0.95), rgba(244,150,50,0.92));">
      Back
    </a>
  </div>
</div>

<script>
  let optionCounter = 2;

  function addOption() {
    optionCounter++;
    const container = document.getElementById('options-container');
    const div = document.createElement('div');
    div.setAttribute('class', 'flex items-center gap-4');
    const input = document.createElement('input');
    input.setAttribute('class', 'glass-input focus-ring px-4 py-3 rounded-2xl text-slate-800 placeholder:text-slate-400 transition-shadow flex-grow');
    input.setAttribute('name', 'option_text');
    input.setAttribute('type', 'text');
    input.setAttribute('placeholder', 'Enter option');
    input.setAttribute('required', '');
    div.appendChild(input);

    if (optionCounter > 2) {
      const removeBtn = document.createElement('button');
      removeBtn.setAttribute('type', 'button');
      removeBtn.setAttribute('class', 'glass-btn px-4 py-2 rounded-2xl text-sm');
      removeBtn.setAttribute('style', 'background-image: linear-gradient(90deg, rgba(244,123,32,0.95), rgba(244,150,50,0.92));');
      removeBtn.textContent = 'Remove';
      removeBtn.onclick = function () {
        container.removeChild(div);
        optionCounter--;
      };
      div.appendChild(removeBtn);
    }

    container.appendChild(div);
  }
</script>
{% endblock %}
